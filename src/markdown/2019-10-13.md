---
id: 4
title: Nuxt.ts + Express で動く Markdown によるブログの作り方
created_at: 2019-10-13
updated_at: 2019-10-13
draft: false
tags: update
---


先月公開したこのブログですが、短時間での開発を目指しつつも、いくつかこだわった点があるので紹介します。

### TL;DR

- **Nust + Express 構成にした.**
    - Microservices アーキテクチャにおける Backend For Frontoend （BFF） の個人的なサンプルになった
    - サーバー内にリソースを持って Server Side Rendering （SSR） できるので高速化・効率化に繋がった
- **GitHub を最大限活用した Markdown ベースのブログとした.**
    - GitHub の Markdown エディタで執筆し、表示もそれに近いものにできた
    - 力技で解決した点が残った..
- **いくつか細かい点でこだわった**
    - API経由で取得したデータをメモリ上にキャッシュした
    - 多言語対応した
    - インフラに kubenetes, ingress を採用してみた

##

### Nuxt + Express 構成にした

#### Nuxt + Express 構成とはどういうことか？

Vue をユニバーサルアプリケーションに拡張するためのフレームワークである Nuxt は広く普及していますが、この Nuxt が「Express のミドルウェアとして動く」
というのはあまり知られていないのではないでしょうか？ 少なくとも自分は割と最近まで知らず、[実践TypeScript](https://note.mu/takepepe/n/nba34ed1ae401)を読んで衝撃を覚えた記憶があります。つまり、Nuxt + Express 構成は下のような形になります。

Inline-style: 
![alt text](https://github.com/kazukiyoshida/nuxt-blog/blob/feature/article/src/assets/images/nuxt%2Bexpress.png "Logo Title Text 1")

#### なにが嬉しいのか？

Express を中心に添えることで Nuxt 単体だとできなかったことが可能になります。 以下は、自分が実際にそのような構成で開発をした訳ではないですが、きっとこうできるだろうという類の例になります

**例1) ビジネスロジックを担当するAPIサーバーが別にあって、そこがマスタデータ（商品カテゴリ一覧とか、地域名一覧とか）を管理している場合**

この場合、Nuxt単体だとユーザーからの初回リクエスト時にそのマスタデータを毎回API経由で取得する必要があります。マスタデータが更新されている可能性があるため、毎回通信が発生します。
一方で Express + Nuxt 構成の場合、夜間バッチでマスタを定期更新することもできるし、APIサーバー側からの通知を受けて更新することもできます。またそのマスタデータもメモリに残すもよし、Redisでも良しで自由度が高いです。SSR時はそのマスタデータを直接使用するのでラウンドトリップなしでいけます。

**例2) サーバーサイドが Microservices で構成されている場合**

バックエンドのサーバーが1つだと、クライアントサイドの Vue から直接そのサーバーを叩けば良いですが、バックエンドが Microservises 構成になっている場合は話が変わります。よく Microservices の文脈では BFF アーキテクチャが紹介されますが、Exprss + Nuxt 構成はこれにぴったりなんじゃないかなと個人的に思っています（本番運用経験はありません）。

概念的には下の図のようになりますが、Express サーバーがフロントエンド専用の API を用意し、クライアントサイドの Vue は Express の API を叩きます。リクエストされた時は、Express はバックエンドの Microservices と gRPC などで通信しつつ、ビジネスロジックを完了する、という形です。

![alt text](https://github.com/kazukiyoshida/nuxt-blog/blob/feature/article/src/assets/images/bff.png "bff")

以上のように、Express + Nuxt 構成にすることで、そこそこ大きい規模のWebアプリケーションにも耐えられ、また BFF としても機能できる、非常に魅力的なアーキテクチャが実現できます。
自分のブログは**全くそのような必要はない**ような小さいアプリケーションですが、個人的な理想を追求したい一心でこのような構成になっています..!
















