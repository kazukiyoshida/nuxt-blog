
<img src="https://github.com/kazukiyoshida/nuxt-blog/blob/master/src/assets/images/20210126/actix.png" alt="actix">



<img src="https://github.com/kazukiyoshida/nuxt-blog/blob/master/src/assets/images/20210126/non-polymorphic.png" alt="non-polymorphic">

Reciever アクターを定義します。

```rust
struct Receiver;

impl Actor for Receiver {
    type Context = Context<Self>;

    fn started(&mut self, _: &mut Self::Context) {
        println!("Receiver : start");
    }
}
```

Receiver アクターは Msg 構造体によるメッセージを受け取り、その時の処理を定義します。

```rust
#[derive(Message)]
#[rtype(result = "()")]
struct Msg(String);

impl Handler<Msg> for Receiver {
    type Result = ();

    fn handle(&mut self, msg: Msg, _: &mut Context<Self>) -> Self::Result {
        println!("Receiver : got a message! >> {:?}", msg.0);
    }
}
```

Messenger アクターは Receiver アクターのアドレスを知っていて、起動時に Receiver に
向けてメッセージを送るものとします。

```rust
struct Messenger(Addr<Receiver>);

impl Actor for Messenger {
    type Context = Context<Self>;

    fn started(&mut self, _: &mut Self::Context) {
        println!("Messenger: start");
        println!("Messenger: send message");
        self.0.do_send(Msg("Hello!!".to_string()));
    }
}
```

これを実行します。

```rust
fn main() {
    let mut sys = System::new("sys");

    let addr_receiver = sys.block_on(async { Receiver.start() });
    let addr_messenger = sys.block_on(async { Messenger(addr_receiver).start() });

    sys.run();
}
```

実行結果はこのようになります。

```
Receiver : start
Messenger: start
Messenger: send message
Receiver : got a message! >> "Hello!!"
```

<img src="https://github.com/kazukiyoshida/nuxt-blog/blob/master/src/assets/images/20210126/polymorphic.png" alt="polymorphic">

Messenger アクターを次のようにジェネリックな構造体に修正します。

```rust
struct Messenger<T: MsgHandler>(Addr<T>);

impl<T> Actor for Messenger<T>
where
    T: MsgHandler,
    T::Context: ToEnvelope<T, Msg>,
{
    type Context = Context<Self>;

    fn started(&mut self, _: &mut Self::Context) {
        println!("Messenger: start");
        println!("Messenger: send message");
        self.0.do_send(Msg("Hello!!".to_string()));
    }
}
```
